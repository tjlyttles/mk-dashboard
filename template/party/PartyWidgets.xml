<?xml version="1.0" encoding="UTF-8"?>
<screen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:noNamespaceSchemaLocation="http://moqui.org/xsd/xml-screen-2.1.xsd"
        default-menu-include="false">

    <parameter name="partyId"/>

    <widgets>
        <section name="CurrentEmploymentSection">
            <widgets>
                <section name="CurrentEmploymentRelationSection" condition="currentEmploymentRelationList.size() > 0">
                    <widgets>
                        <section-iterate name="CurrentEmploymentIterator" list="currentEmploymentRelationList" entry="employmentRelation">
                            <actions>
                                <entity-find entity-name="mantle.party.PartyClassificationAppl" list="partyClassList">
                                    <econdition field-name="partyId" from="employmentRelation.toPartyId"/>
                                    <date-filter/>
                                </entity-find>
                                <entity-find-one entity-name="mantle.party.PartyRelationshipSetting" value-field="employmentStatusSetting">
                                    <field-map field-name="partyRelationshipId" from="employmentRelation.partyRelationshipId"/>
                                    <field-map field-name="partySettingTypeId" value="EmploymentStatus"/>
                                </entity-find-one>
                                <entity-find entity-name="mk.close.FinancialFlow" list="monthlyIncomeFinFlowList">
                                    <econdition field-name="partyId" from="employmentRelation.fromPartyId"/>
                                    <econdition field-name="entryTypeEnumId" value="MkEntryIncome"/>
                                    <econdition field-name="financialFlowTypeEnumId" value="MkFinFlowTotalMonthlyIncome"/>
                                    <econdition field-name="partyRelationshipId" from="employmentRelation.partyRelationshipId"/>
                                </entity-find>
                                <service-call name="mkdecision.dashboard.PartyServices.get#PrimaryTelecomNumber" in-map="[partyId: employmentRelation.toPartyId]" out-map="telecomNumberResp"/>
                                <service-call name="mkdecision.dashboard.PartyServices.get#PrimaryPostalAddress" in-map="[partyId: employmentRelation.toPartyId]" out-map="postalAddressResp"/>

                                <set field="employerClassificationId" from="partyClassList?.getFirst()?.partyClassificationId ?: null"/>
                                <set field="employerName" from="employmentRelation.organizationName"/>
                                <set field="jobTitle" from="employmentRelation.relationshipName"/>
                                <set field="employmentStatusEnumId" from="employmentStatusSetting?.settingValue"/>
                                <set field="monthlyIncome" from="monthlyIncomeFinFlowList?.getFirst()?.amount ?: null"/>
                                <set field="millis" from="Math.abs(employmentRelation.fromDate.getTime() - ec.user.nowTimestamp.getTime())"/>
                                <set field="days" from="java.util.concurrent.TimeUnit.DAYS.convert(millis, java.util.concurrent.TimeUnit.MILLISECONDS)"/>
                                <set field="years" from="Math.floor(days / 365)" type="Integer"/>
                                <set field="months" from="Math.floor(days / 30.4) - (years * 12)" type="Integer"/>
                                <log level="warn" message=">> ${years}"/>
                                <log level="warn" message=">> ${months}"/>
                                <set field="employerContactNumber" from="telecomNumberResp.contactNumber"/>
                                <set field="employerAddress1" from="postalAddressResp.postalAddress?.address1"/>
                                <set field="employerUnitNumber" from="postalAddressResp.postalAddress?.unitNumber"/>
                                <set field="employerPostalCode" from="postalAddressResp.postalAddress?.postalCode"/>
                                <set field="employerCity" from="postalAddressResp.postalAddress?.city"/>
                                <set field="employerStateProvinceGeoId" from="postalAddressResp.postalAddress?.stateProvinceGeoId"/>
                            </actions>
                            <widgets>
                                <container-row>
                                    <row-col xs="6" sm="6" md="6" lg="6">
                                        <container style="margin-tb-05">
                                            <label text="${employerName}"/>
                                        </container>
                                    </row-col>
                                    <row-col xs="6" sm="6" md="6" lg="6" style="text-right">
                                        <section-include name="EditCurrentRegularEmployment" location="component://mk-dashboard/template/party/PartyForms.xml"/>
                                        <section-include name="EditCurrentSelfEmployment" location="component://mk-dashboard/template/party/PartyForms.xml"/>
                                        <link text="Remove" btn-type="danger" url="deleteEmployment" parameter-map="[orderId: orderId, partyId: partyId, partyRelationshipId: employmentRelation.partyRelationshipId]"/>
                                    </row-col>
                                </container-row>
                                <container style="h-separator margin-tb-05"/>
                            </widgets>
                        </section-iterate>
                        <container style="margin-tb-2"/>
                    </widgets>
                </section>
                <container style="block margin-tb-1">
                    <section-include name="AddCurrentRegularEmployment" location="component://mk-dashboard/template/party/PartyForms.xml"/>
                </container>
                <container style="block margin-tb-1">
                    <section-include name="AddCurrentSelfEmployment" location="component://mk-dashboard/template/party/PartyForms.xml"/>
                </container>
            </widgets>
        </section>

        <section name="PreviousEmploymentSection">
            <widgets>
                <section name="PreviousEmploymentRelationSection" condition="previousEmploymentRelationList.size() > 0">
                    <widgets>
                        <section-iterate name="PreviousEmploymentIterator" list="previousEmploymentRelationList" entry="employmentRelation">
                            <actions>
                                <entity-find entity-name="mantle.party.PartyClassificationAppl" list="partyClassList">
                                    <econdition field-name="partyId" from="employmentRelation.toPartyId"/>
                                    <date-filter/>
                                </entity-find>
                                <entity-find-one entity-name="mantle.party.PartyRelationshipSetting" value-field="employmentStatusSetting">
                                    <field-map field-name="partyRelationshipId" from="employmentRelation.partyRelationshipId"/>
                                    <field-map field-name="partySettingTypeId" value="EmploymentStatus"/>
                                </entity-find-one>
                                <entity-find entity-name="mk.close.FinancialFlow" list="monthlyIncomeFinFlowList">
                                    <econdition field-name="partyId" from="employmentRelation.fromPartyId"/>
                                    <econdition field-name="entryTypeEnumId" value="MkEntryIncome"/>
                                    <econdition field-name="financialFlowTypeEnumId" value="MkFinFlowTotalMonthlyIncome"/>
                                    <econdition field-name="partyRelationshipId" from="employmentRelation.partyRelationshipId"/>
                                </entity-find>
                                <service-call name="mkdecision.dashboard.PartyServices.get#PrimaryTelecomNumber" in-map="[partyId: employmentRelation.toPartyId]" out-map="telecomNumberResp"/>
                                <service-call name="mkdecision.dashboard.PartyServices.get#PrimaryPostalAddress" in-map="[partyId: employmentRelation.toPartyId]" out-map="postalAddressResp"/>

                                <set field="employerClassificationId" from="partyClassList?.getFirst()?.partyClassificationId ?: null"/>
                                <set field="employerName" from="employmentRelation.organizationName"/>
                                <set field="jobTitle" from="employmentRelation.relationshipName"/>
                                <set field="employmentStatusEnumId" from="employmentStatusSetting?.settingValue"/>
                                <set field="monthlyIncome" from="monthlyIncomeFinFlowList?.getFirst()?.amount ?: null"/>
                                <set field="fromDate" from="ec.l10n.format(employmentRelation.fromDate, 'MM-dd-yyyy') ?: null"/>
                                <set field="toDate" from="ec.l10n.format(employmentRelation.thruDate, 'MM-dd-yyyy') ?: null"/>
                                <set field="employerContactNumber" from="telecomNumberResp.contactNumber"/>
                                <set field="employerAddress1" from="postalAddressResp.postalAddress?.address1"/>
                                <set field="employerUnitNumber" from="postalAddressResp.postalAddress?.unitNumber"/>
                                <set field="employerPostalCode" from="postalAddressResp.postalAddress?.postalCode"/>
                                <set field="employerCity" from="postalAddressResp.postalAddress?.city"/>
                                <set field="employerStateProvinceGeoId" from="postalAddressResp.postalAddress?.stateProvinceGeoId"/>
                            </actions>
                            <widgets>
                                <container-row>
                                    <row-col xs="6" sm="6" md="6" lg="6">
                                        <container style="margin-tb-05">
                                            <label text="${employerName}"/>
                                        </container>
                                    </row-col>
                                    <row-col xs="6" sm="6" md="6" lg="6" style="text-right">
                                        <section-include name="EditPreviousRegularEmployment" location="component://mk-dashboard/template/party/PartyForms.xml"/>
                                        <section-include name="EditPreviousSelfEmployment" location="component://mk-dashboard/template/party/PartyForms.xml"/>
                                        <link text="Remove" btn-type="danger" url="deleteEmployment" parameter-map="[orderId: orderId, orderPartSeqId: orderPartSeqId, partyId: partyId, partyRelationshipId: employmentRelation.partyRelationshipId]"/>
                                    </row-col>
                                </container-row>
                                <container style="h-separator margin-tb-05"/>
                            </widgets>
                        </section-iterate>
                        <container style="margin-tb-2"/>
                    </widgets>
                </section>
                <container style="block margin-tb-1">
                    <section-include name="AddPreviousRegularEmployment" location="component://mk-dashboard/template/party/PartyForms.xml"/>
                </container>
                <container style="block margin-tb-1">
                    <section-include name="AddPreviousSelfEmployment" location="component://mk-dashboard/template/party/PartyForms.xml"/>
                </container>
            </widgets>
        </section>

        <section name="IncomeSourceSection">
            <widgets>
                <section name="IncomeSourceFinFlowSection" condition="incomeFinFlowList.size() > 0">
                    <widgets>
                        <section-iterate name="IncomeSourceFinFlowIterator" list="incomeFinFlowList" entry="incomeFinFlow">
                            <actions>
                                <entity-find-related-one value-field="incomeFinFlow" relationship-name="flowType" to-value-field="flowType"/>

                                <set field="financialFlowTypeEnumId" from="incomeFinFlow.financialFlowTypeEnumId"/>
                                <set field="amount" from="incomeFinFlow.amount"/>
                                <set field="millis" from="Math.abs(incomeFinFlow.fromDate.getTime() - ec.user.nowTimestamp.getTime())"/>
                                <set field="days" from="java.util.concurrent.TimeUnit.DAYS.convert(millis, java.util.concurrent.TimeUnit.MILLISECONDS)"/>
                                <set field="years" from="Math.floor(days / 365)" type="Integer"/>
                                <set field="months" from="Math.floor(days / 30.4) - (years * 12)" type="Integer"/>
                            </actions>
                            <widgets>
                                <container-row>
                                    <row-col xs="6" sm="6" md="6" lg="6">
                                        <container style="margin-tb-05">
                                            <label text="${flowType.description}"/>
                                        </container>
                                    </row-col>
                                    <row-col xs="6" sm="6" md="6" lg="6" style="text-right">
                                        <section-include name="EditIncomeSource" location="component://mk-dashboard/template/party/PartyForms.xml"/>
                                        <link text="Remove" btn-type="danger" url="deleteIncomeSource" parameter-map="[orderId: orderId, orderPartSeqId: orderPartSeqId, partyId: partyId, financialFlowId: incomeFinFlow.financialFlowId]"/>
                                    </row-col>
                                </container-row>
                                <container style="h-separator margin-tb-05"/>
                            </widgets>
                        </section-iterate>
                        <container style="margin-tb-2"/>
                    </widgets>
                </section>
                <container style="block margin-tb-1">
                    <section-include name="AddIncomeSource" location="component://mk-dashboard/template/party/PartyForms.xml"/>
                </container>
            </widgets>
        </section>

        <section name="MortgageSection">
            <widgets>
                <section name="MortgageRelationSection" condition="mortgageRelationList.size() > 0">
                    <widgets>
                        <section-iterate name="MortgageIterator" list="mortgageRelationList" entry="mortgageRelation">
                            <actions>
                                <entity-find-one entity-name="mk.close.FinancialFlow" value-field="mortgageFinFlow">
                                    <field-map field-name="partyId" from="mortgageRelation.fromPartyId"/>
                                    <field-map field-name="financialFlowTypeEnumId" value="MkFinFlowMortgage"/>
                                    <field-map field-name="entryTypeEnumId" value="MkEntryExpense"/>
                                    <field-map field-name="partyRelationshipId" from="mortgageRelation.partyRelationshipId"/>
                                </entity-find-one>

                                <set field="partyRelationshipId" from="mortgageRelation.partyRelationshipId"/>
                                <set field="lenderName" from="mortgageRelation.organizationName"/>
                                <set field="mortgageBalance" from="mortgageFinFlow.balance"/>
                                <set field="mortgagePaymentMonthly" from="mortgageFinFlow.amount"/>
                            </actions>
                            <widgets>
                                <container-row>
                                    <row-col xs="6" sm="6" md="6" lg="6">
                                        <container style="margin-tb-05">
                                            <label text="${lenderName}"/>
                                        </container>
                                    </row-col>
                                    <row-col xs="6" sm="6" md="6" lg="6" style="text-right">
                                        <section-include name="EditMortgage" location="component://mk-dashboard/template/party/PartyForms.xml"/>
                                        <link text="Remove" btn-type="danger" url="deleteMortgage" parameter-map="[orderId: orderId, partyId: partyId, partyRelationshipId: mortgageRelation.partyRelationshipId]"/>
                                    </row-col>
                                </container-row>
                                <container style="h-separator margin-tb-05"/>
                            </widgets>
                        </section-iterate>
                        <container style="margin-tb-2"/>
                    </widgets>
                </section>
                <container style="block margin-tb-1">
                    <section-include name="AddMortgage" location="component://mk-dashboard/template/party/PartyForms.xml"/>
                </container>
            </widgets>
        </section>

        <section name="IdentitySection" condition="identityList.size() > 0">
            <widgets>
                <section-iterate name="IdentityIterator" list="identityList" entry="identity">
                    <actions>
                        <entity-find-related-one value-field="identity" relationship-name="type" to-value-field="idType"/>
                        <set field="partyIdTypeEnumId" from="identity.partyIdTypeEnumId"/>
                        <set field="idValue" from="identity.idValue"/>
                        <set field="idIssuedBy" from="identity.issuedBy"/>
                        <set field="idIssueDate" from="ec.l10n.format(identity.issueDate, 'MM-dd-yyyy')"/>
                        <set field="idExpiryDate" from="ec.l10n.format(identity.expireDate, 'MM-dd-yyyy')"/>
                    </actions>
                    <widgets>
                        <container-row>
                            <row-col xs="6" sm="6" md="6" lg="6">
                                <container style="margin-tb-05">
                                    <label text="${idType.description}"/>
                                </container>
                            </row-col>
                            <row-col xs="6" sm="6" md="6" lg="6" style="text-right">
                                <section-include name="EditDriversLicense" location="component://mk-dashboard/template/party/PartyForms.xml"/>
                                <section-include name="EditStateIssuedId" location="component://mk-dashboard/template/party/PartyForms.xml"/>
                                <section-include name="EditMilitaryId" location="component://mk-dashboard/template/party/PartyForms.xml"/>
                                <section-include name="EditPassport" location="component://mk-dashboard/template/party/PartyForms.xml"/>
                                <section-include name="EditPermanentResidentCard" location="component://mk-dashboard/template/party/PartyForms.xml"/>
                                <link text="Remove" btn-type="danger" url="deleteIdentity" parameter-map="[orderId: orderId, partyId: partyId, partyIdTypeEnumId: identity.partyIdTypeEnumId]"/>
                            </row-col>
                        </container-row>
                    </widgets>
                </section-iterate>
            </widgets>
            <fail-widgets>
                <container style="block margin-tb-1">
                    <section-include name="AddDriversLicense" location="component://mk-dashboard/template/party/PartyForms.xml"/>
                </container>
                <container style="block margin-tb-1">
                    <section-include name="AddStateIssuedId" location="component://mk-dashboard/template/party/PartyForms.xml"/>
                </container>
                <container style="block margin-tb-1">
                    <section-include name="AddMilitaryId" location="component://mk-dashboard/template/party/PartyForms.xml"/>
                </container>
                <container style="block margin-tb-1">
                    <section-include name="AddPassport" location="component://mk-dashboard/template/party/PartyForms.xml"/>
                </container>
                <container style="block margin-tb-1">
                    <section-include name="AddPermanentResidentCard" location="component://mk-dashboard/template/party/PartyForms.xml"/>
                </container>
            </fail-widgets>
        </section>

        <section name="PersonSection" condition="partyDetail.partyTypeEnumId == 'PtyPerson'">
            <widgets>
                <container>
                    <label text="${partyName}" type="h4"/>
                    <label text="${roleType.description}"/>
                </container>

                <container style="q-pt-md">
                    <container-row>
                        <row-col sm="8" xs="8" md="8" lg="8"  style="padding-all-0">
                            <label text="Personal" type="h6"/>
                        </row-col>
                        <row-col sm="4" xs="4" md="4" lg="4" style="text-right">
                            <section-include name="EditPerson" location="component://mk-dashboard/template/party/PartyForms.xml"/>
                        </row-col>
                    </container-row>
                    <container style="q-pt-sm">
                        <container-row>
                            <row-col lg="3" md="3" sm="4" xs="12" style="padding-all-0"><label text="First name" style="text-light-grey"/></row-col>
                            <row-col lg="9" md="9" sm="8" xs="12" style="padding-all-0"><label text="${firstName ?: '-'}"/></row-col>
                        </container-row>
                        <container-row>
                            <row-col lg="3" md="3" sm="4" xs="12" style="padding-all-0"><label text="Middle Name" style="text-light-grey"/></row-col>
                            <row-col lg="9" md="9" sm="8" xs="12" style="padding-all-0"><label text="${middleName ?: '-'}"/></row-col>
                        </container-row>
                        <container-row>
                            <row-col lg="3" md="3" sm="4" xs="12" style="padding-all-0"><label text="Last name" style="text-light-grey"/></row-col>
                            <row-col lg="9" md="9" sm="8" xs="12" style="padding-all-0"><label text="${lastName ?: '-'}"/></row-col>
                        </container-row>
                        <container-row>
                            <row-col lg="3" md="3" sm="4" xs="12" style="padding-all-0"><label text="Suffix" style="text-light-grey"/></row-col>
                            <row-col lg="9" md="9" sm="8" xs="12" style="padding-all-0"><label text="${suffix ?: '-'}"/></row-col>
                        </container-row>
                        <container-row>
                            <row-col lg="3" md="3" sm="4" xs="12" style="padding-all-0"><label text="Other Name (AKA)" style="text-light-grey"/></row-col>
                            <row-col lg="9" md="9" sm="8" xs="12" style="padding-all-0"><label text="${nickname ?: '-'}"/></row-col>
                        </container-row>
                        <container-row>
                            <row-col lg="3" md="3" sm="4" xs="12" style="padding-all-0"><label text="Social Security Number" style="text-light-grey"/></row-col>
                            <row-col lg="9" md="9" sm="8" xs="12" style="padding-all-0"><label text="${socialSecurityNumber ?: '-'}"/></row-col>
                        </container-row>
                        <container-row>
                            <row-col lg="3" md="3" sm="4" xs="12" style="padding-all-0"><label text="Date of Birth" style="text-light-grey"/></row-col>
                            <row-col lg="9" md="9" sm="8" xs="12" style="padding-all-0"><label text="${birthDate}"/></row-col>
                        </container-row>
                        <container-row>
                            <row-col lg="3" md="3" sm="4" xs="12" style="padding-all-0"><label text="Marital Status" style="text-light-grey"/></row-col>
                            <row-col lg="9" md="9" sm="8" xs="12" style="padding-all-0"><label text="${maritalStatus.description ?: '-'}"/></row-col>
                        </container-row>
                        <container-row>
                            <row-col lg="3" md="3" sm="4" xs="12" style="padding-all-0"><label text="Employment Status" style="text-light-grey"/></row-col>
                            <row-col lg="9" md="9" sm="8" xs="12" style="padding-all-0"><label text="${employmentStatus.description ?: '-'}"/></row-col>
                        </container-row>
                        <container-row>
                            <row-col lg="3" md="3" sm="4" xs="12" style="padding-all-0"><label text="Occupation" style="text-light-grey"/></row-col>
                            <row-col lg="9" md="9" sm="8" xs="12" style="padding-all-0"><label text="${currentEmploymentRelationList.getFirst()?.relationshipName ?: '-'}"/></row-col>
                        </container-row>
                    </container>
                </container>

                <container style="q-pt-md">
                    <container-row>
                        <row-col sm="8" xs="8" md="8" lg="8" style="padding-all-0">
                            <label text="Contact" type="h6"/>
                        </row-col>
                        <row-col sm="4" xs="4" md="4" lg="4" style="text-right">
                            <section-include name="EditContact" location="component://mk-dashboard/template/party/PartyForms.xml"/>
                        </row-col>
                    </container-row>
                    <container style="q-pt-sm">
                        <container-row>
                            <row-col lg="3" md="3" sm="4" xs="12" style="padding-all-0"><label text="Primary phone number" style="text-light-grey"/></row-col>
                            <row-col lg="9" md="9" sm="8" xs="12" style="padding-all-0">
                                <link link-type="anchor" url="tel:${contactNumber ?: '-'}" text="${contactNumber ?: '-'}" url-type="plain"/>
                            </row-col>
                        </container-row>
                        <container-row>
                            <row-col lg="3" md="3" sm="4" xs="12" style="padding-all-0"><label text="Email" style="text-light-grey"/></row-col>
                            <row-col lg="9" md="9" sm="8" xs="12" style="padding-all-0">
                                <link link-type="anchor" url="mailto:${emailAddress ?: '-'}" text="${emailAddress ?: '-'}" url-type="plain"/>
                            </row-col>
                        </container-row>
                        <container-row>
                            <row-col lg="3" md="3" sm="4" xs="12" style="padding-all-0"><label text="Residential Address" style="text-light-grey"/></row-col>
                            <row-col lg="9" md="9" sm="8" xs="12" style="padding-all-0"><label text="${postalAddressString ?: '-'}"/></row-col>
                        </container-row>
                        <container-row>
                            <row-col lg="3" md="3" sm="4" xs="12" style="padding-all-0"><label text="Address Duration" style="text-light-grey"/></row-col>
                            <row-col lg="9" md="9" sm="8" xs="12" style="padding-all-0"><label text="${addressYears ?: '-'} years ${addressMonths ?: '-'} months"/></row-col>
                        </container-row>
                    </container>
                </container>

                <section-iterate name="PersonIdentityIterator" list="identityList" entry="identity">
                    <actions>
                        <entity-find-related-one value-field="identity" relationship-name="type" to-value-field="idType"/>
                        <set field="partyIdTypeEnumId" from="identity.partyIdTypeEnumId"/>
                        <set field="idValue" from="identity.idValue"/>
                        <set field="idIssuedBy" from="identity.issuedBy"/>
                        <set field="idIssueDate" from="ec.l10n.format(identity.issueDate, 'MM-dd-yyyy')"/>
                        <set field="idExpiryDate" from="ec.l10n.format(identity.expireDate, 'MM-dd-yyyy')"/>
                    </actions>
                    <widgets>
                        <container style="q-pt-md">
                            <container-row>
                                <row-col sm="8" xs="8" md="8" lg="8"  style="padding-all-0">
                                    <label text="Identity ${identity_index + 1}" type="h6"/>
                                </row-col>
                                <row-col sm="4" xs="4" md="4" lg="4" style="text-right">
                                    <section-include name="EditDriversLicense" location="component://mk-dashboard/template/party/PartyForms.xml"/>
                                    <section-include name="EditStateIssuedId" location="component://mk-dashboard/template/party/PartyForms.xml"/>
                                    <section-include name="EditMilitaryId" location="component://mk-dashboard/template/party/PartyForms.xml"/>
                                    <section-include name="EditPassport" location="component://mk-dashboard/template/party/PartyForms.xml"/>
                                    <section-include name="EditPermanentResidentCard" location="component://mk-dashboard/template/party/PartyForms.xml"/>
                                </row-col>
                            </container-row>
                            <container style="q-pt-sm">
                                <container-row>
                                    <row-col lg="3" md="3" sm="4" xs="12" style="padding-all-0"><label text="Type" style="text-light-grey"/></row-col>
                                    <row-col lg="9" md="9" sm="8" xs="12" style="padding-all-0"><label text="${idType.description}"/></row-col>
                                </container-row>
                                <container-row>
                                    <row-col lg="3" md="3" sm="4" xs="12" style="padding-all-0"><label text="ID Number" style="text-light-grey"/></row-col>
                                    <row-col lg="9" md="9" sm="8" xs="12" style="padding-all-0"><label text="${identity.idValue}"/></row-col>
                                </container-row>
                                <container-row>
                                    <row-col lg="3" md="3" sm="4" xs="12" style="padding-all-0"><label text="${idType.enumId == 'PtidPassport' || idType.enumId == 'PtidArn' || idType.enumId == 'PtidMilitaryId' ? 'Country Issued' : 'State Issued'}" style="text-light-grey"/></row-col>
                                    <row-col lg="9" md="9" sm="8" xs="12" style="padding-all-0"><label text="${identity.issuedBy}"/></row-col>
                                </container-row>
                                <section name="idIssueDate" condition="idType.enumId != 'PtidArn'">
                                    <widgets>
                                        <container-row>
                                            <row-col lg="3" md="3" sm="4" xs="12" style="padding-all-0"><label text="Issue Date" style="text-light-grey"/></row-col>
                                            <row-col lg="9" md="9" sm="8" xs="12" style="padding-all-0"><label text="${ec.l10n.format(identity.issueDate, 'MM-dd-yyyy')}"/></row-col>
                                        </container-row>
                                    </widgets>
                                </section>
                                <container-row>
                                    <row-col lg="3" md="3" sm="4" xs="12" style="padding-all-0"><label text="Expiration Date" style="text-light-grey"/></row-col>
                                    <row-col lg="9" md="9" sm="8" xs="12" style="padding-all-0"><label text="${ec.l10n.format(identity.expireDate, 'MM-dd-yyyy')}"/></row-col>
                                </container-row>
                            </container>
                        </container>
                    </widgets>
                </section-iterate>

                <section-iterate name="PersonCurrentEmploymentIterator" list="currentEmploymentRelationList" entry="employmentRelation">
                    <actions>
                        <entity-find entity-name="mantle.party.PartyClassificationAppl" list="partyClassList">
                            <econdition field-name="partyId" from="employmentRelation.toPartyId"/>
                            <date-filter/>
                        </entity-find>
                        <entity-find-one entity-name="mantle.party.PartyRelationshipSetting" value-field="employmentStatusSetting">
                            <field-map field-name="partyRelationshipId" from="employmentRelation.partyRelationshipId"/>
                            <field-map field-name="partySettingTypeId" value="EmploymentStatus"/>
                        </entity-find-one>
                        <entity-find entity-name="mk.close.FinancialFlow" list="monthlyIncomeFinFlowList">
                            <econdition field-name="partyId" from="employmentRelation.fromPartyId"/>
                            <econdition field-name="entryTypeEnumId" value="MkEntryIncome"/>
                            <econdition field-name="financialFlowTypeEnumId" value="MkFinFlowTotalMonthlyIncome"/>
                            <econdition field-name="partyRelationshipId" from="employmentRelation.partyRelationshipId"/>
                        </entity-find>
                        <service-call name="mkdecision.dashboard.PartyServices.get#PrimaryTelecomNumber" in-map="[partyId: employmentRelation.toPartyId]" out-map="telecomNumberResp"/>
                        <service-call name="mkdecision.dashboard.PartyServices.get#PrimaryPostalAddress" in-map="[partyId: employmentRelation.toPartyId]" out-map="postalAddressResp"/>

                        <set field="employerClassificationId" from="partyClassList?.getFirst()?.partyClassificationId ?: null"/>
                        <set field="employerName" from="employmentRelation.organizationName"/>
                        <set field="jobTitle" from="employmentRelation.relationshipName"/>
                        <set field="employmentStatusEnumId" from="employmentStatusSetting?.settingValue"/>
                        <set field="monthlyIncome" from="monthlyIncomeFinFlowList?.getFirst()?.amount ?: null"/>
                        <set field="millis" from="Math.abs(employmentRelation.fromDate.getTime() - ec.user.nowTimestamp.getTime())"/>
                        <set field="days" from="java.util.concurrent.TimeUnit.DAYS.convert(millis, java.util.concurrent.TimeUnit.MILLISECONDS)"/>
                        <set field="years" from="Math.floor(days / 365)" type="Integer"/>
                        <set field="months" from="Math.floor(days / 30.4) - (years * 12)" type="Integer"/>
                        <set field="employerContactNumber" from="telecomNumberResp.contactNumber"/>
                        <set field="employerPostalAddress" from="postalAddressResp.postalAddressString"/>
                        <set field="employerAddress1" from="postalAddressResp.postalAddress?.address1"/>
                        <set field="employerUnitNumber" from="postalAddressResp.postalAddress?.unitNumber"/>
                        <set field="employerPostalCode" from="postalAddressResp.postalAddress?.postalCode"/>
                        <set field="employerCity" from="postalAddressResp.postalAddress?.city"/>
                        <set field="employerStateProvinceGeoId" from="postalAddressResp.postalAddress?.stateProvinceGeoId"/>
                    </actions>
                    <widgets>
                        <container style="q-pt-md">
                            <container-row>
                                <row-col sm="8" xs="8" md="8" lg="8"  style="padding-all-0">
                                    <label text="Current Employment ${employmentRelation_index + 1}" type="h6"/>
                                </row-col>
                                <row-col sm="4" xs="4" md="4" lg="4" style="text-right">
                                    <section-include name="EditCurrentRegularEmployment" location="component://mk-dashboard/template/party/PartyForms.xml"/>
                                    <section-include name="EditCurrentSelfEmployment" location="component://mk-dashboard/template/party/PartyForms.xml"/>
                                </row-col>
                            </container-row>
                            <container style="q-pt-sm">
                                <container-row>
                                    <row-col lg="3" md="3" sm="4" xs="12" style="padding-all-0"><label text="Employer Name" style="text-light-grey"/></row-col>
                                    <row-col lg="9" md="9" sm="8" xs="12" style="padding-all-0"><label text="${employerName}"/></row-col>
                                </container-row>
                                <container-row>
                                    <row-col lg="3" md="3" sm="4" xs="12" style="padding-all-0"><label text="Gross Monthly Income" style="text-light-grey"/></row-col>
                                    <row-col lg="9" md="9" sm="8" xs="12" style="padding-all-0"><label text="${ec.l10n.formatCurrency(monthlyIncome, null)}"/></row-col>
                                </container-row>
                                <container-row>
                                    <row-col lg="3" md="3" sm="4" xs="12" style="padding-all-0"><label text="Duration" style="text-light-grey"/></row-col>
                                    <row-col lg="9" md="9" sm="8" xs="12" style="padding-all-0"><label text="${years} years ${months} months"/></row-col>
                                </container-row>
                                <container-row>
                                    <row-col lg="3" md="3" sm="4" xs="12" style="padding-all-0"><label text="Occupation" style="text-light-grey"/></row-col>
                                    <row-col lg="9" md="9" sm="8" xs="12" style="padding-all-0"><label text="${jobTitle ?: '-'}"/></row-col>
                                </container-row>
                                <container-row>
                                    <row-col lg="3" md="3" sm="4" xs="12" style="padding-all-0"><label text="Employer Address" style="text-light-grey"/></row-col>
                                    <row-col lg="9" md="9" sm="8" xs="12" style="padding-all-0"><label text="${employerPostalAddress ?: '-'}"/></row-col>
                                </container-row>
                                <container-row>
                                    <row-col lg="3" md="3" sm="4" xs="12" style="padding-all-0"><label text="Employer Phone Number" style="text-light-grey"/></row-col>
                                    <row-col lg="9" md="9" sm="8" xs="12" style="padding-all-0"><link link-type="anchor" url="tel:${employerContactNumber ?: '-'}" text="${employerContactNumber ?: '-'}" url-type="plain"/></row-col>
                                </container-row>
                            </container>
                        </container>
                    </widgets>
                </section-iterate>

                <section-iterate name="PersonIncomeSourceIterator" list="incomeFinFlowList" entry="incomeFinFlow">
                    <actions>
                        <entity-find-related-one value-field="incomeFinFlow" relationship-name="flowType" to-value-field="flowType"/>

                        <set field="financialFlowTypeEnumId" from="incomeFinFlow.financialFlowTypeEnumId"/>
                        <set field="amount" from="incomeFinFlow.amount"/>
                        <set field="millis" from="Math.abs(incomeFinFlow.fromDate.getTime() - ec.user.nowTimestamp.getTime())"/>
                        <set field="days" from="java.util.concurrent.TimeUnit.DAYS.convert(millis, java.util.concurrent.TimeUnit.MILLISECONDS)"/>
                        <set field="years" from="Math.floor(days / 365)" type="Integer"/>
                        <set field="months" from="Math.floor(days / 30.4) - (years * 12)" type="Integer"/>
                    </actions>
                    <widgets>
                        <container style="q-pt-md">
                            <container-row>
                                <row-col sm="8" xs="8" md="8" lg="8"  style="padding-all-0">
                                    <label text="Current Non-Employment Income ${incomeFinFlow_index + 1}" type="h6"/>
                                </row-col>
                                <row-col sm="4" xs="4" md="4" lg="4" style="text-right">
                                    <section-include name="EditIncomeSource" location="component://mk-dashboard/template/party/PartyForms.xml"/>
                                </row-col>
                            </container-row>
                            <container style="q-pt-sm">
                                <container-row>
                                    <row-col lg="3" md="3" sm="4" xs="12" style="padding-all-0"><label text="Income Source Type" style="text-light-grey"/></row-col>
                                    <row-col lg="9" md="9" sm="8" xs="12" style="padding-all-0"><label text="${flowType.description}"/></row-col>
                                </container-row>
                                <container-row>
                                    <row-col lg="3" md="3" sm="4" xs="12" style="padding-all-0"><label text="Gross Monthly Income" style="text-light-grey"/></row-col>
                                    <row-col lg="9" md="9" sm="8" xs="12" style="padding-all-0"><label text="${ec.l10n.formatCurrency(amount, null)}"/></row-col>
                                </container-row>
                                <container-row>
                                    <row-col lg="3" md="3" sm="4" xs="12" style="padding-all-0"><label text="Duration" style="text-light-grey"/></row-col>
                                    <row-col lg="9" md="9" sm="8" xs="12" style="padding-all-0"><label text="${years} years ${months} months"/></row-col>
                                </container-row>
                            </container>
                        </container>
                    </widgets>
                </section-iterate>

                <section-iterate name="PersonPreviousEmploymentIterator" list="previousEmploymentRelationList" entry="employmentRelation">
                    <actions>
                        <entity-find entity-name="mantle.party.PartyClassificationAppl" list="partyClassList">
                            <econdition field-name="partyId" from="employmentRelation.toPartyId"/>
                            <date-filter/>
                        </entity-find>
                        <entity-find-one entity-name="mantle.party.PartyRelationshipSetting" value-field="employmentStatusSetting">
                            <field-map field-name="partyRelationshipId" from="employmentRelation.partyRelationshipId"/>
                            <field-map field-name="partySettingTypeId" value="EmploymentStatus"/>
                        </entity-find-one>
                        <entity-find entity-name="mk.close.FinancialFlow" list="monthlyIncomeFinFlowList">
                            <econdition field-name="partyId" from="employmentRelation.fromPartyId"/>
                            <econdition field-name="entryTypeEnumId" value="MkEntryIncome"/>
                            <econdition field-name="financialFlowTypeEnumId" value="MkFinFlowTotalMonthlyIncome"/>
                            <econdition field-name="partyRelationshipId" from="employmentRelation.partyRelationshipId"/>
                        </entity-find>
                        <service-call name="mkdecision.dashboard.PartyServices.get#PrimaryTelecomNumber" in-map="[partyId: employmentRelation.toPartyId]" out-map="telecomNumberResp"/>
                        <service-call name="mkdecision.dashboard.PartyServices.get#PrimaryPostalAddress" in-map="[partyId: employmentRelation.toPartyId]" out-map="postalAddressResp"/>

                        <set field="employerClassificationId" from="partyClassList?.getFirst()?.partyClassificationId ?: null"/>
                        <set field="employerName" from="employmentRelation.organizationName"/>
                        <set field="employmentStatusEnumId" from="employmentStatusSetting?.settingValue"/>
                        <set field="monthlyIncome" from="monthlyIncomeFinFlowList?.getFirst()?.amount ?: null"/>
                        <set field="jobTitle" from="employmentRelation.relationshipName"/>
                        <set field="fromDate" from="ec.l10n.format(employmentRelation.fromDate, 'MM-dd-yyyy')"/>
                        <set field="toDate" from="ec.l10n.format(employmentRelation.thruDate, 'MM-dd-yyyy')"/>
                        <set field="employerContactNumber" from="telecomNumberResp.contactNumber"/>
                        <set field="employerPostalAddress" from="postalAddressResp.postalAddressString"/>
                        <set field="employerAddress1" from="postalAddressResp.postalAddress?.address1"/>
                        <set field="employerUnitNumber" from="postalAddressResp.postalAddress?.unitNumber"/>
                        <set field="employerPostalCode" from="postalAddressResp.postalAddress?.postalCode"/>
                        <set field="employerCity" from="postalAddressResp.postalAddress?.city"/>
                        <set field="employerStateProvinceGeoId" from="postalAddressResp.postalAddress?.stateProvinceGeoId"/>
                    </actions>
                    <widgets>
                        <container style="q-pt-md">
                            <container-row>
                                <row-col sm="8" xs="8" md="8" lg="8"  style="padding-all-0">
                                    <label text="Previous Employment ${employmentRelation_index + 1}" type="h6"/>
                                </row-col>
                                <row-col sm="4" xs="4" md="4" lg="4" style="text-right">
                                    <section-include name="EditPreviousRegularEmployment" location="component://mk-dashboard/template/party/PartyForms.xml"/>
                                    <section-include name="EditPreviousSelfEmployment" location="component://mk-dashboard/template/party/PartyForms.xml"/>
                                </row-col>
                            </container-row>
                            <container style="q-pt-sm">
                                <container-row>
                                    <row-col lg="3" md="3" sm="4" xs="12" style="padding-all-0"><label text="Employer Name" style="text-light-grey"/></row-col>
                                    <row-col lg="9" md="9" sm="8" xs="12" style="padding-all-0"><label text="${employerName}"/></row-col>
                                </container-row>
                                <container-row>
                                    <row-col lg="3" md="3" sm="4" xs="12" style="padding-all-0"><label text="Gross Monthly Income" style="text-light-grey"/></row-col>
                                    <row-col lg="9" md="9" sm="8" xs="12" style="padding-all-0"><label text="${ec.l10n.formatCurrency(monthlyIncome, null)}"/></row-col>
                                </container-row>
                                <container-row>
                                    <row-col lg="3" md="3" sm="4" xs="12" style="padding-all-0"><label text="From Date" style="text-light-grey"/></row-col>
                                    <row-col lg="9" md="9" sm="8" xs="12" style="padding-all-0"><label text="${ec.l10n.format(employmentRelation.fromDate, 'MM-dd-yyyy') ?: ''}"/></row-col>
                                </container-row>
                                <container-row>
                                    <row-col lg="3" md="3" sm="4" xs="12" style="padding-all-0"><label text="To Date" style="text-light-grey"/></row-col>
                                    <row-col lg="9" md="9" sm="8" xs="12" style="padding-all-0"><label text="${ec.l10n.format(employmentRelation.thruDate, 'MM-dd-yyyy') ?: ''}"/></row-col>
                                </container-row>
                                <container-row>
                                    <row-col lg="3" md="3" sm="4" xs="12" style="padding-all-0"><label text="Occupation" style="text-light-grey"/></row-col>
                                    <row-col lg="9" md="9" sm="8" xs="12" style="padding-all-0"><label text="${jobTitle ?: '-'}"/></row-col>
                                </container-row>
                                <container-row>
                                    <row-col lg="3" md="3" sm="4" xs="12" style="padding-all-0"><label text="Employer Address" style="text-light-grey"/></row-col>
                                    <row-col lg="9" md="9" sm="8" xs="12" style="padding-all-0"><label text="${employerPostalAddress ?: '-'}"/></row-col>
                                </container-row>
                                <container-row>
                                    <row-col lg="3" md="3" sm="4" xs="12" style="padding-all-0"><label text="Employer Phone Number" style="text-light-grey"/></row-col>
                                    <row-col lg="9" md="9" sm="8" xs="12" style="padding-all-0"><link link-type="anchor" url="tel:${employerContactNumber ?: '-'}" text="${employerContactNumber ?: '-'}" url-type="plain"/></row-col>
                                </container-row>
                            </container>
                        </container>
                    </widgets>
                </section-iterate>
            </widgets>
        </section>

        <section name="PropertySection">
            <widgets>
                <container>
                    <label text="Property" type="h4"/>
                </container>

                <container style="q-pt-md">
                    <container-row>
                        <row-col sm="8" xs="8" md="8" lg="8"  style="padding-all-0">
                            <label text="Property Information" type="h6"/>
                        </row-col>
                        <row-col sm="4" xs="4" md="4" lg="4" style="text-right">
                            <section-include name="EditProperty" location="component://mk-dashboard/template/party/PartyForms.xml"/>
                        </row-col>
                    </container-row>
                    <container style="q-pt-sm">
                        <container-row>
                            <row-col lg="3" md="3" sm="4" xs="12" style="padding-all-0"><label text="Address" style="text-light-grey"/></row-col>
                            <row-col lg="9" md="9" sm="8" xs="12" style="padding-all-0"><label text="${postalAddressString}"/></row-col>
                        </container-row>
                        <container-row>
                            <row-col lg="3" md="3" sm="4" xs="12" style="padding-all-0"><label text="Type" style="text-light-grey"/></row-col>
                            <row-col lg="9" md="9" sm="8" xs="12" style="padding-all-0"><label text="${assetClass.description ?: '-'}"/></row-col>
                        </container-row>
                        <container-row>
                            <row-col lg="3" md="3" sm="4" xs="12" style="padding-all-0"><label text="Current Property Value (Estimate)" style="text-light-grey"/></row-col>
                            <row-col lg="9" md="9" sm="8" xs="12" style="padding-all-0"><label text="${ec.l10n.formatCurrency(salvageValue ?: 0, orderHeader.currencyUomId)}"/></row-col>
                        </container-row>
                        <container-row>
                            <row-col lg="3" md="3" sm="4" xs="12" style="padding-all-0"><label text="Original Purchase Price" style="text-light-grey"/></row-col>
                            <row-col lg="9" md="9" sm="8" xs="12" style="padding-all-0"><label text="${ec.l10n.formatCurrency(acquireCost ?: 0, orderHeader.currencyUomId)}"/></row-col>
                        </container-row>
                        <container-row>
                            <row-col lg="3" md="3" sm="4" xs="12" style="padding-all-0"><label text="HOA Fee Monthly" style="text-light-grey"/></row-col>
                            <row-col lg="9" md="9" sm="8" xs="12" style="padding-all-0"><label text="${ec.l10n.formatCurrency(hoaFeeMonthly ?: 0, orderHeader.currencyUomId)}"/></row-col>
                        </container-row>
                        <container-row>
                            <row-col lg="3" md="3" sm="4" xs="12" style="padding-all-0"><label text="Property Tax Monthly" style="text-light-grey"/></row-col>
                            <row-col lg="9" md="9" sm="8" xs="12" style="padding-all-0"><label text="${ec.l10n.formatCurrency(propertyTaxesMonthly ?: 0, orderHeader.currencyUomId)}"/></row-col>
                        </container-row>
                        <container-row>
                            <row-col lg="3" md="3" sm="4" xs="12" style="padding-all-0"><label text="Property Insurance Costs Monthly" style="text-light-grey"/></row-col>
                            <row-col lg="9" md="9" sm="8" xs="12" style="padding-all-0"><label text="${ec.l10n.formatCurrency(propertyInsuranceCostsMonthly ?: 0, orderHeader.currencyUomId)}"/></row-col>
                        </container-row>
                    </container>
                </container>

                <section-iterate name="MortgageRelationIterator" list="mortgageRelationList" entry="mortgageRelation">
                    <actions>
                        <entity-find-one entity-name="mk.close.FinancialFlow" value-field="financialFlow">
                            <field-map field-name="partyId" from="mortgageRelation.fromPartyId"/>
                            <field-map field-name="financialFlowTypeEnumId" value="MkFinFlowMortgage"/>
                            <field-map field-name="entryTypeEnumId" value="MkEntryExpense"/>
                            <field-map field-name="partyRelationshipId" from="mortgageRelation.partyRelationshipId"/>
                        </entity-find-one>

                        <set field="partyRelationshipId" from="mortgageRelation.partyRelationshipId"/>
                        <set field="lenderName" from="mortgageRelation.organizationName"/>
                        <set field="mortgageBalance" from="financialFlow.balance"/>
                        <set field="mortgagePaymentMonthly" from="financialFlow.amount"/>
                    </actions>
                    <widgets>
                        <container style="q-pt-md">
                            <container-row>
                                <row-col sm="8" xs="8" md="8" lg="8"  style="padding-all-0">
                                    <label text="Mortgage ${mortgageRelation_index + 1}" type="h6"/>
                                </row-col>
                                <row-col sm="4" xs="4" md="4" lg="4" style="text-right">
                                    <section-include name="EditMortgage" location="component://mk-dashboard/template/party/PartyForms.xml"/>
                                </row-col>
                            </container-row>
                            <container style="q-pt-sm">
                                <container-row>
                                    <row-col lg="12" md="12" sm="12" xs="12" style="padding-all-0"><label text="Mortgage ${sectionEntryIndex + 1}" style="text-light-grey"/></row-col>
                                </container-row>
                                <container-row>
                                    <row-col lg="3" md="3" sm="4" xs="12" style="padding-all-0"><label text="Lender Name" style="text-light-grey"/></row-col>
                                    <row-col lg="9" md="9" sm="8" xs="12" style="padding-all-0"><label text="${lenderName ?: '-'}"/></row-col>
                                </container-row>
                                <container-row>
                                    <row-col lg="3" md="3" sm="4" xs="12" style="padding-all-0"><label text="Mortgage Balance" style="text-light-grey"/></row-col>
                                    <row-col lg="9" md="9" sm="8" xs="12" style="padding-all-0"><label text="${ec.l10n.formatCurrency(mortgageBalance, orderHeader.currencyUomId)}"/></row-col>
                                </container-row>
                                <container-row>
                                    <row-col lg="3" md="3" sm="4" xs="12" style="padding-all-0"><label text="Mortgage Payment Monthly" style="text-light-grey"/></row-col>
                                    <row-col lg="9" md="9" sm="8" xs="12" style="padding-all-0"><label text="${ec.l10n.formatCurrency(mortgagePaymentMonthly, orderHeader.currencyUomId)}"/></row-col>
                                </container-row>
                            </container>
                        </container>
                    </widgets>
                </section-iterate>
            </widgets>
        </section>
    </widgets>
</screen>
